generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountType {
  FREELANCER
  ENTREPRENEUR
  WORKER
  EMPLOYER
  INVESTOR
}

enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
  MEMBER
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ReportStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
}

enum JobStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum IntegrationType {
  MICRO
  YOUTUBE
  FACEBOOK
  INSTAGRAM
  TWITTER
  LINKEDIN
}

enum IntegrationStatus {
  PENDING_APPROVAL
  APPROVED
  REJECTED
  REVOKED
}

enum CompanyJoinRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

enum CompanyVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum PermissionType {
  API_ACCESS
  COMPANY_INFO_EDIT
  REPORT_VIEW
  REPORT_CREATE
  TASK_ASSIGN
  USER_MANAGE
  FINANCIAL_VIEW
}

enum SubscriptionPlan {
  SILVER
  GOLD
  PLATINUM
  PRIME
}

enum AdvertisementStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CommissionStatus {
  PENDING
  PAID
  CANCELLED
}

enum TwoFactorMethod {
  TOTP
  SMS
  EMAIL
}

enum KYCStatus {
  NOT_STARTED
  PENDING
  VERIFIED
  REJECTED
  EXPIRED
}

model User {
  id            String      @id @default(cuid())
  email         String      @unique
  name          String?
  image         String?
  emailVerified DateTime?
  accountType   AccountType
  password      String?
  twoFactorEnabled Boolean  @default(false)
  twoFactorSecret String?
  twoFactorMethod TwoFactorMethod?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  accounts      Account[]
  sessions      Session[]
  twoFactorBackupCodes TwoFactorBackupCode[]
  kycVerification KYCVerification?

  profile       Profile?

  companies     CompanyMember[]
  companyJoinRequests CompanyJoinRequest[]

  freelancerProfile FreelancerProfile?
  jobApplications   JobApplication[]
  ratings          Rating[]
  badges           UserBadge[]
  commissions      Commission[] @relation("FreelancerCommissions")

  entrepreneurProfile EntrepreneurProfile?
  startups           Startup[] @relation("EntrepreneurStartups")
  startupMembers     StartupMember[]
  projects           Project[] @relation("EntrepreneurProjects")
  createdProjects    Project[] @relation("ProjectCreator")
  aiChats            AIChat[]

  workerProfile WorkerProfile?
  taskAssignments TaskAssignment[]
  reportAccess  ReportAccess[]

  employerProfile EmployerProfile?
  jobPostings     JobPosting[]
  ownedCompanies  Company[] @relation("CompanyOwner")

  investorProfile InvestorProfile?
  investments     Investment[]
  investmentRequests InvestmentRequest[] @relation("InvestorRequests")

  integrations   Integration[]
  integrationRequests IntegrationRequest[]
  approvedIntegrationRequests IntegrationRequest[] @relation("IntegrationApprover")

  permissions    Permission[] @relation("PermissionUser")
  grantedPermissions Permission[] @relation("PermissionGranter")
  sharedPermissions PermissionShare[] @relation("PermissionShareUser")
  sharedPermissionsAsSharer PermissionShare[] @relation("PermissionShareSharer")

  createdTasks   Task[] @relation("TaskCreator")
  createdReports Report[] @relation("ReportCreator")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Profile {
  id            String   @id @default(cuid())
  userId        String   @unique
  bio           String?
  phone         String?
  location      String?
  website       String?
  skills        String[]
  experience    Int?
  hourlyRate    Float?
  availability  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Company {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  website     String?
  logo        String?
  industry    String?
  size        String?
  location    String?
  verificationStatus CompanyVerificationStatus @default(PENDING)
  verificationDocuments Json?
  verificationNotes String? @db.Text
  verifiedAt  DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  ownerId     String
  owner       User     @relation("CompanyOwner", fields: [ownerId], references: [id])
  members     CompanyMember[]
  joinRequests CompanyJoinRequest[]
  jobPostings JobPosting[]
  integrations CompanyIntegration[]
  companyIntegrations Integration[] @relation("CompanyIntegrations")
  subscription CompanySubscription?
  advertisements Advertisement[]
  projects     Project[]
}

model CompanyIntegration {
  id             String   @id @default(cuid())
  companyId      String
  integrationId  String
  createdAt      DateTime @default(now())

  company        Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  integration    Integration @relation("CompanyIntegrationIntegration", fields: [integrationId], references: [id], onDelete: Cascade)

  @@unique([companyId, integrationId])
}

model Integration {
  id          String            @id @default(cuid())
  userId      String
  companyId   String?
  type        IntegrationType
  status      IntegrationStatus @default(PENDING_APPROVAL)
  accessToken String?           @db.Text
  refreshToken String?          @db.Text
  metadata    Json?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  company     Company?          @relation("CompanyIntegrations", fields: [companyId], references: [id], onDelete: Cascade)
  companyIntegrations CompanyIntegration[] @relation("CompanyIntegrationIntegration")

  @@index([userId])
  @@index([companyId])
}

model EntrepreneurProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  bio         String?  @db.Text
  expertise   String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  startups    Startup[] @relation("EntrepreneurProfileStartups")
}

model Startup {
  id                     String   @id @default(cuid())
  name                   String
  description            String   @db.Text
  industry               String?
  stage                  String?
  website                String?
  logo                   String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  entrepreneurId          String
  entrepreneur            User   @relation("EntrepreneurStartups", fields: [entrepreneurId], references: [id], onDelete: Cascade)
  entrepreneurProfileId   String?
  entrepreneurProfile     EntrepreneurProfile? @relation("EntrepreneurProfileStartups", fields: [entrepreneurProfileId], references: [id], onDelete: Cascade)

  members                 StartupMember[]
  reports                 Report[]
  investmentRequests      InvestmentRequest[]
  projects                Project[] @relation("StartupProjects")
}
